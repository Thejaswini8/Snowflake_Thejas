In SQL Grant Access for DBT
GRANT All PRIVILEGES ON DATABASE BANKING TO ROLE pc_dbt_role;
GRANT All PRIVILEGES ON schema BANKING.RAW TO ROLE pc_dbt_role;
GRANT All PRIVILEGES ON FUTURE TABLES IN DATABASE BANKING TO ROLE PC_DBT_ROLE;
REVOKE APPLYBUDGET ON DATABASE PC_DBT_DB FROM ROLE PC_DBT_ROLE;
SHOW GRANTS ON DATABASE PC_DBT_DB;
---------------------------------
---create udf
create or replace function trans_func(amount number)
returns string
language sql 
as
$$
select case when amount > 500 then 'High'
        when amount between 100 and 200 then 'Medium'
        else 'Low' end
$$
;
In DBT -> Model -> Example ->
Transaction_model.sql
select *, BANKING.RAW.TRANS_FUNC(amount) as risk_level from BANKING.RAW.transactions
-----------------------------------------------------------------------------------------
CREATE OR REPLACE DATABASE BANKING;
CREATE OR REPLACE SCHEMA BANKING.RAW;
CREATE OR REPLACE SCHEMA BANKING.CLEANSED;
CREATE OR REPLACE SCHEMA BANKING.REPORT; 

CREATE OR REPLACE WAREHOUSE BANK_IMPORT
WAREHOUSE_SIZE='X-SMALL'
WAREHOUSE_TYPE='STANDARD'
AUTO_SUSPEND=200
INITIALLY_SUSPENDED=TRUE;

CREATE OR REPLACE WAREHOUSE BANK_TRANSFORM
WAREHOUSE_SIZE='X-SMALL'
WAREHOUSE_TYPE='STANDARD'
AUTO_SUSPEND=500
INITIALLY_SUSPENDED=TRUE;

CREATE OR REPLACE WAREHOUSE BANK_REPORT
WAREHOUSE_SIZE='X-SMALL'
WAREHOUSE_TYPE='STANDARD'
AUTO_SUSPEND=300
INITIALLY_SUSPENDED=TRUE;

-- Creating Roles
CREATE ROLE IMPORT_ROLE;
CREATE ROLE TRANSFORM_ROLE;
CREATE ROLE REPORTING_ROLE;

-- Granting role privileges
-- IMPORT_ROLE
GRANT USAGE ON WAREHOUSE BANK_IMPORT TO ROLE IMPORT_ROLE;
GRANT USAGE ON DATABASE BANKING TO ROLE IMPORT_ROLE;
GRANT USAGE ON SCHEMA BANKING.RAW TO ROLE IMPORT_ROLE;
GRANT USAGE ON SCHEMA BANKING.CLEAN TO ROLE IMPORT_ROLE;
GRANT ALL PRIVILEGES ON SCHEMA BANKING.RAW TO ROLE IMPORT_ROLE;
GRANT ALL PRIVILEGES ON SCHEMA BANKING.CLEAN TO ROLE IMPORT_ROLE;

-- TRANSFORM_ROLE
GRANT USAGE ON WAREHOUSE BANK_TRANSFORM TO ROLE TRANSFORM_ROLE;
GRANT USAGE ON DATABASE BANKING TO ROLE TRANSFORM_ROLE;
GRANT USAGE ON SCHEMA BANKING.CLEAN TO ROLE TRANSFORM_ROLE;
GRANT USAGE ON SCHEMA BANKING.REPORT TO ROLE TRANSFORM_ROLE;
GRANT ALL PRIVILEGES ON SCHEMA BANKING.CLEAN TO ROLE TRANSFORM_ROLE;
GRANT ALL PRIVILEGES ON SCHEMA BANKING.REPORT TO ROLE TRANSFORM_ROLE;

GRANT All PRIVILEGES ON DATABASE BANKING TO ROLE pc_dbt_role;
GRANT All PRIVILEGES ON FUTURE TABLES IN DATABASE BANKING TO ROLE PC_DBT_ROLE;
REVOKE APPLYBUDGET ON DATABASE PC_DBT_DB FROM ROLE PC_DBT_ROLE;
SHOW GRANTS ON DATABASE PC_DBT_DB;

-- REPORTING_ROLE
GRANT USAGE ON WAREHOUSE REPORTING_WH TO ROLE REPORTING_ROLE;
GRANT USAGE ON DATABASE BANKING TO ROLE REPORTING_ROLE;
GRANT USAGE ON SCHEMA BANKING.REPORT TO ROLE REPORTING_ROLE;
GRANT SELECT ON ALL TABLES IN SCHEMA BANKING.REPORT TO ROLE REPORTING_ROLE;
GRANT SELECT ON FUTURE TABLES IN SCHEMA BANKING.REPORT TO ROLE REPORTING_ROLE;


-- • 3 USERS (Test Users)
-- o UserReporting (belongs to REPORTING_ROLE)
-- o UserTransform (belongs to TRANSFORM_ROLE)
-- o UserImport (belongs to IMPORT_ROLE)

CREATE USER UserReporting PASSWORD='StrongPassword123!' DEFAULT_ROLE = REPORTING_ROLE  MUST_CHANGE_PASSWORD=FALSE;
GRANT ROLE REPORTING_ROLE TO USER UserReporting;

CREATE USER UserTransform PASSWORD='StrongPassword123!' DEFAULT_ROLE = TRANSFORM_ROLE  MUST_CHANGE_PASSWORD=FALSE;
GRANT ROLE TRANSFORM_ROLE TO USER UserTransform;

CREATE USER UserImport PASSWORD='StrongPassword123!' DEFAULT_ROLE = IMPORT_ROLE  MUST_CHANGE_PASSWORD=FALSE;
GRANT ROLE IMPORT_ROLE TO USER UserImport;

-- • 3 USAGE MONITORS
-- o IMPORT_MONITOR (100 credits a month)
-- o TRANSFORM_MONITOR (100 credits a month)
-- o REPORTING_MONITOR (100 credits a month)

-- Create Resource Monitors
CREATE RESOURCE MONITOR IMPORT_MONITOR WITH CREDIT_QUOTA = 30;
CREATE RESOURCE MONITOR TRANSFORM_MONITOR WITH CREDIT_QUOTA = 60;
CREATE RESOURCE MONITOR REPORTING_MONITOR WITH CREDIT_QUOTA = 40;

-- Assign Resource Monitors to Warehouses
ALTER WAREHOUSE IMPORT_WH SET RESOURCE_MONITOR = IMPORT_MONITOR;
ALTER WAREHOUSE TRANSFORM_WH SET RESOURCE_MONITOR = TRANSFORM_MONITOR;
ALTER WAREHOUSE REPORTING_WH SET RESOURCE_MONITOR = REPORTING_MONITOR;
